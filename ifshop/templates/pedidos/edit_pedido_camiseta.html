{% extends "base.html" %}

{% load static %}
{% load crispy_forms_filters %}

{% block title %}Editar Pedido{% endblock %}
{% block filtro %}{% endblock %}

{% block content %}
<div class="d-flex justify-content-center py-5">
    <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
        <div class="col p-4 d-flex flex-column position-static">
            
            <!-- Informações da camiseta -->
            <strong class="d-inline-block mb-2 text-primary-emphasis">
                Data para pedidos até {{ pedido.camiseta.data_limite_pedidos }}
            </strong>
            <h3 class="mb-0">{{ pedido.camiseta.titulo }}</h3>
            <div class="mb-3 text-body-secondary">Preço: R$ {{ pedido.camiseta.preco }}</div>
            
            <!-- Formulário de edição do pedido -->
            <form method="post" class="row g-3">
                {% csrf_token %}

                <div class="col-md-6">{{ form.nome_estampa|as_crispy_field }}</div>
                <div class="col-md-6">{{ form.numero_estampa|as_crispy_field }}</div>
                <div class="col-md-6">{{ form.estilo|as_crispy_field }}</div>
                <div class="col-md-6">{{ form.tamanho|as_crispy_field }}</div>
                <div class="col-md-6">{{ form.cor_escolhida|as_crispy_field }}</div>
                <div class="col-md-6">{{ form.forma_pag|as_crispy_field }}</div>

                <div class="col-12 mt-3">
                    <button type="submit" class="btn botoes shadow-lg rounded px-3 d-flex justify-content-center">
                        Salvar Alterações
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Script para atualizar tamanhos dinamicamente -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const tamanhosPorEstilo = {{ tamanhos_por_estilo_json|safe }};
    const estiloSelect = document.getElementById('id_estilo');
    const tamanhoSelect = document.getElementById('id_tamanho');

    function atualizarTamanhos(estiloSelecionado) {
        const tamanhos = tamanhosPorEstilo[estiloSelecionado] || [];

        // Limpar os tamanhos antigos
        tamanhoSelect.innerHTML = '';

        // Adicionar os novos tamanhos
        tamanhos.forEach(function (tamanho) {
            const option = document.createElement('option');
            option.value = tamanho;
            option.textContent = tamanho;
            tamanhoSelect.appendChild(option);
        });

        // Manter o tamanho previamente selecionado, se ainda existir
        const tamanhoAnterior = "{{ form.initial.tamanho }}";
        if (tamanhoAnterior && tamanhos.includes(tamanhoAnterior)) {
            tamanhoSelect.value = tamanhoAnterior;
        }
    }

    // Atualizar quando o estilo mudar
    estiloSelect.addEventListener('change', function () {
        atualizarTamanhos(this.value);
    });

    // Atualizar ao carregar a página se já houver estilo selecionado
    if (estiloSelect.value) {
        atualizarTamanhos(estiloSelect.value);
    }
});
</script>
{% endblock %}
